<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>APIP Assistant</title>
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary: #475569;
      --light: #f8fafc;
      --dark: #1e293b;
      --danger: #dc2626;
      --success: #16a34a;
      --gray: #94a3b8;
      --light-gray: #e2e8f0;
      --border-radius: 8px;
      --shadow: 0 4px 6px rgba(0,0,0,0.05);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', system-ui, sans-serif;
    }

    body {
      background: var(--light);
      color: var(--dark);
      line-height: 1.6;
      min-height: 100vh;
    }

    /* Header Styles */
    header {
      background: var(--primary);
      color: white;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo i {
      font-size: 1.8rem;
    }

    nav ul {
      display: flex;
      list-style: none;
      gap: 1.5rem;
    }

    nav a {
      color: white;
      text-decoration: none;
      font-weight: 500;
      padding: 0.5rem;
      border-radius: 4px;
      transition: background 0.3s;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    nav a:hover, nav a.active {
      background: rgba(255,255,255,0.2);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .logout-btn {
      background: transparent;
      color: white;
      border: 1px solid white;
      border-radius: 4px;
      padding: 0.25rem 0.75rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .logout-btn:hover {
      background: white;
      color: var(--primary);
    }

    /* Main Content Styles */
    main {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    .card {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    h2 {
      margin-bottom: 1.5rem;
      color: var(--primary-dark);
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--light-gray);
    }

    /* Login Styles */
    #loginPage {
      display: flex;
      min-height: 100vh;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      padding: 2rem;
    }

    .login-container {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      width: 100%;
      max-width: 450px;
      overflow: hidden;
    }

    .login-header {
      background: var(--primary);
      color: white;
      padding: 2rem;
      text-align: center;
    }

    .login-header h1 {
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
    }

    .login-header p {
      opacity: 0.9;
    }

    .login-form {
      padding: 2rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--dark);
    }

    .form-group input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--light-gray);
      border-radius: var(--border-radius);
      font-size: 1rem;
      transition: border-color 0.3s;
    }

    .form-group input:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
    }

    .login-btn {
      width: 100%;
      padding: 0.75rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      font-weight: 500;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.3s;
    }

    .login-btn:hover {
      background: var(--primary-dark);
    }

    .error-message {
      color: var(--danger);
      margin-top: 1rem;
      text-align: center;
      display: none;
    }

    /* Chat Styles */
    .chat-container {
      display: grid;
      grid-template-columns: 3fr 1fr;
      gap: 2rem;
    }

    .chat-history {
      max-height: 60vh;
      overflow-y: auto;
      padding: 1rem;
      background: #f1f5f9;
      border-radius: var(--border-radius);
    }

    .message {
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: var(--border-radius);
      word-break: break-word;
    }

    .user-message {
      background: #dbeafe;
      margin-left: 20%;
    }

    .ai-message {
      background: #ede9fe;
      margin-right: 20%;
    }

    .system-message {
      background: #f0fdf4;
      text-align: center;
      font-size: 0.9rem;
      padding: 0.5rem;
    }

    .chat-input-area {
      display: flex;
      margin-top: 1rem;
    }

    .chat-input-area input {
      flex: 1;
      padding: 0.75rem;
      border: 1px solid var(--light-gray);
      border-radius: var(--border-radius) 0 0 var(--border-radius);
      font-size: 1rem;
    }

    .chat-input-area button {
      padding: 0.75rem 1.5rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 0 var(--border-radius) var(--border-radius) 0;
      cursor: pointer;
      transition: background 0.3s;
    }

    .chat-input-area button:hover {
      background: var(--primary-dark);
    }

    /* Upload Styles */
    .upload-area {
      border: 2px dashed var(--light-gray);
      border-radius: var(--border-radius);
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 1rem;
    }

    .upload-area:hover {
      border-color: var(--primary);
      background: rgba(37, 99, 235, 0.05);
    }

    .upload-area p {
      margin-bottom: 0.5rem;
      color: var(--secondary);
    }

    .upload-area small {
      color: var(--gray);
    }

    .upload-btn {
      display: block;
      width: 100%;
      padding: 0.75rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      font-weight: 500;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.3s;
      margin-top: 1rem;
    }

    .upload-btn:hover {
      background: var(--primary-dark);
    }

    .status-message {
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: var(--border-radius);
      text-align: center;
      display: none;
    }

    .success {
      background: #dcfce7;
      color: var(--success);
      display: block;
    }

    .error {
      background: #fee2e2;
      color: var(--danger);
      display: block;
    }

    /* Utility Classes */
    .hidden {
      display: none;
    }

    /* Icons */
    .material-icons {
      font-family: 'Material Icons';
      font-weight: normal;
      font-style: normal;
      font-size: 24px;
      display: inline-block;
      line-height: 1;
      text-transform: none;
      letter-spacing: normal;
      word-wrap: normal;
      white-space: nowrap;
      direction: ltr;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
      -moz-osx-font-smoothing: grayscale;
      font-feature-settings: 'liga';
      vertical-align: middle;
    }
  </style>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
  <!-- Login Page -->
  <div id="loginPage">
    <div class="login-container">
      <div class="login-header">
        <h1>APIP Assistant</h1>
        <p>Sistem Pendukung Pengawasan Internal</p>
      </div>
      <div class="login-form">
        <div class="form-group">
          <label for="username">Username</label>
          <input type="text" id="username" placeholder="Masukkan username">
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" placeholder="Masukkan password">
        </div>
        <button class="login-btn" id="loginBtn">Login</button>
        <div id="loginError" class="error-message">Username atau password salah</div>
      </div>
    </div>
  </div>

  <!-- Main App (hidden until login) -->
  <div id="app" class="hidden">
    <header>
      <div class="logo">
        <span class="material-icons">verified_user</span>
        <span>APIP Assistant</span>
      </div>
      <nav>
        <ul>
          <li><a href="#" class="active" data-section="chat"><span class="material-icons">forum</span> Chat</a></li>
          <li><a href="#" data-section="upload"><span class="material-icons">upload</span> Upload</a></li>
          <li><a href="#" data-section="history"><span class="material-icons">history</span> History</a></li>
          <li><a href="#" data-section="knowledge"><span class="material-icons">library_books</span> Knowledge Base</a></li>
        </ul>
      </nav>
      <div class="user-info">
        <div class="user-avatar" id="userAvatar">A</div>
        <button class="logout-btn" id="logoutBtn">Logout</button>
      </div>
    </header>

    <main>
      <!-- Chat Section -->
      <section id="chat" class="card">
        <h2><span class="material-icons">forum</span> Chat Assistant</h2>
        <div class="chat-container">
          <div class="chat-history" id="chatHistory">
            <div class="system-message">Selamat datang di APIP Assistant. Silakan ajukan pertanyaan atau unggah dokumen untuk dianalisis.</div>
          </div>
          <div>
            <h3>Upload Dokumen Pendukung</h3>
            <div class="upload-area" id="uploadArea">
              <p>Drop file PDF/DOC disini atau klik untuk upload</p>
              <small>Format yang didukung: PDF, DOCX, TXT</small>
              <input type="file" id="fileInput" hidden accept=".pdf,.doc,.docx,.txt">
            </div>
          </div>
        </div>
        <div class="chat-input-area">
          <input type="text" id="userInput" placeholder="Tulis pertanyaan...">
          <button id="sendBtn">Kirim</button>
        </div>
      </section>

      <!-- Upload Section -->
      <section id="upload" class="card" style="display: none;">
        <h2><span class="material-icons">upload</span> Upload ke Knowledge Base</h2>
        <div class="upload-area" id="kbUploadArea">
          <p>Drop file PDF/DOC disini atau klik untuk upload</p>
          <small>Format yang didukung: PDF, DOCX, TXT</small>
          <input type="file" id="kbFileInput" hidden accept=".pdf,.doc,.docx,.txt">
        </div>
        <div class="form-group">
          <label for="docName">Nama Dokumen</label>
          <input type="text" id="docName" placeholder="Masukkan nama dokumen">
        </div>
        <button class="upload-btn" id="uploadKbBtn">Upload ke Knowledge Base</button>
        <div id="kbUploadStatus" class="status-message"></div>
      </section>

      <!-- History Section -->
      <section id="history" class="card" style="display: none;">
        <h2><span class="material-icons">history</span> History Percakapan</h2>
        <div id="historyList" style="max-height: 60vh; overflow-y: auto;">
          <div class="message">Belum ada history percakapan</div>
        </div>
      </section>

      <!-- Knowledge Base Section -->
      <section id="knowledge" class="card" style="display: none;">
        <h2><span class="material-icons">library_books</span> Knowledge Base</h2>
        <div id="knowledgeList" style="max-height: 60vh; overflow-y: auto;">
          <div class="message">Belum ada dokumen di knowledge base</div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // DOM Elements
    const loginPage = document.getElementById('loginPage');
    const app = document.getElementById('app');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const loginError = document.getElementById('loginError');
    const userAvatar = document.getElementById('userAvatar');
    const chatHistory = document.getElementById('chatHistory');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const fileInput = document.getElementById('fileInput');
    const uploadArea = document.getElementById('uploadArea');
    const kbFileInput = document.getElementById('kbFileInput');
    const kbUploadArea = document.getElementById('kbUploadArea');
    const docName = document.getElementById('docName');
    const uploadKbBtn = document.getElementById('uploadKbBtn');
    const kbUploadStatus = document.getElementById('kbUploadStatus');
    const navLinks = document.querySelectorAll('nav a');
    const sections = {
      chat: document.getElementById('chat'),
      upload: document.getElementById('upload'),
      history: document.getElementById('history'),
      knowledge: document.getElementById('knowledge')
    };

    // State
    let currentUser = null;
    let chatMessages = [];

    // Event Listeners
    loginBtn.addEventListener('click', login);
    logoutBtn.addEventListener('click', logout);
    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', e => {
      if (e.key === 'Enter') sendMessage();
    });
    uploadArea.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', handleFileUpload);
    kbUploadArea.addEventListener('click', () => kbFileInput.click());
    kbFileInput.addEventListener('change', handleKbFileSelect);
    uploadKbBtn.addEventListener('click', uploadToKnowledgeBase);

    // Navigation
    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const sectionId = link.getAttribute('data-section');
        showSection(sectionId);
      });
    });

    // Functions
    function showSection(sectionId) {
      // Hide all sections
      Object.values(sections).forEach(section => {
        section.style.display = 'none';
      });
      // Show the selected section
      if (sections[sectionId]) {
        sections[sectionId].style.display = 'block';
      }
      // Update active link
      navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('data-section') === sectionId) {
          link.classList.add('active');
        }
      });
    }

    async function login() {
      const username = usernameInput.value.trim();
      const password = passwordInput.value.trim();

      if (!username || !password) {
        showError('Username dan password harus diisi');
        return;
      }

      try {
        // Simulasi login
        // Di aplikasi nyata, ini akan memanggil endpoint login
        await new Promise(resolve => setTimeout(resolve, 1000));

        // Set user
        currentUser = {
          username: username,
          role: username === 'admin' ? 'admin' : 'user',
          avatar: username.charAt(0).toUpperCase()
        };

        // Update UI
        userAvatar.textContent = currentUser.avatar;
        loginPage.classList.add('hidden');
        app.classList.remove('hidden');
      } catch (error) {
        showError('Username atau password salah');
      }
    }

    function logout() {
      currentUser = null;
      app.classList.add('hidden');
      loginPage.classList.remove('hidden');
      // Reset form
      usernameInput.value = '';
      passwordInput.value = '';
      loginError.style.display = 'none';
    }

    function showError(message) {
      loginError.textContent = message;
      loginError.style.display = 'block';
    }

    async function sendMessage() {
      const message = userInput.value.trim();
      if (!message) return;

      addMessage(message, 'user');
      userInput.value = '';

      try {
        // Simulasi AI response
        await new Promise(resolve => setTimeout(resolve, 1500));

        const responses = [
          "Saya menemukan beberapa potensi temuan berdasarkan dokumen yang Anda upload: \n\n### Temuan\nTerdapat ketidaksesuaian dalam pelaporan keuangan bulan April 2023.\n\n### Analisis\nDari dokumen yang diupload, ditemukan selisih sebesar Rp 15.000.000 antara laporan keuangan dan bukti transaksi.\n\n### Rekomendasi\nDisarankan untuk melakukan verifikasi ulang terhadap transaksi bulan April 2023 dan memperbaiki sistem pencatatan transaksi.",
          "Berdasarkan dokumen yang Anda berikan, berikut analisis saya: \n\n### Temuan\nPenggunaan anggaran tidak sesuai dengan perencanaan.\n\n### Analisis\nDari total anggaran Rp 50.000.000, hanya Rp 35.000.000 yang digunakan sesuai rencana, sementara Rp 15.000.000 digunakan untuk keperluan lain tanpa persetujuan.\n\n### Rekomendasi\nPerlu dilakukan penertiban dalam penggunaan anggaran dan pembuatan mekanisme persetujuan untuk perubahan alokasi anggaran.",
          "Dari dokumen yang Anda upload, saya menemukan: \n\n### Temuan\nProses pengadaan barang tanpa lelang untuk nilai di atas batas yang diizinkan.\n\n### Analisis\nTerdapat 3 pengadaan barang dengan total nilai Rp 120.000.000 yang dilakukan tanpa proses lelang, padahal sesuai peraturan, pengadaan di atas Rp 50.000.000 harus melalui lelang.\n\n### Rekomendasi\nDisarankan untuk meninjau ulang proses pengadaan dan menerapkan sanksi sesuai peraturan yang berlaku."
        ];

        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
        addMessage(randomResponse, 'ai');
      } catch (error) {
        addMessage(`Error: ${error.message}`, 'ai');
      }
    }

    function addMessage(text, sender) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender}-message`;
      messageDiv.textContent = text;
      chatHistory.appendChild(messageDiv);
      chatHistory.scrollTop = chatHistory.scrollHeight;

      // Simpan di state
      chatMessages.push({
        text,
        sender,
        timestamp: new Date().toISOString()
      });
    }

    async function handleFileUpload(e) {
      const file = e.target.files[0];
      if (!file) return;

      try {
        addMessage(`Mengupload file: ${file.name}...`, 'system');

        // Simulasi upload
        await new Promise(resolve => setTimeout(resolve, 2000));

        addMessage(`File "${file.name}" berhasil diupload dan siap dianalisis`, 'system');
      } catch (error) {
        addMessage(`Error: ${error.message}`, 'system');
      } finally {
        // Reset input file
        fileInput.value = '';
      }
    }

    function handleKbFileSelect(e) {
      const file = e.target.files[0];
      if (file) {
        kbUploadStatus.textContent = `File dipilih: ${file.name}`;
        kbUploadStatus.className = 'status-message success';
      }
    }

    async function uploadToKnowledgeBase() {
      const file = kbFileInput.files[0];
      const documentName = docName.value.trim();

      if (!file) {
        kbUploadStatus.textContent = 'Pilih file terlebih dahulu';
        kbUploadStatus.className = 'status-message error';
        return;
      }
      if (!documentName) {
        kbUploadStatus.textContent = 'Nama dokumen harus diisi';
        kbUploadStatus.className = 'status-message error';
        return;
      }

      kbUploadStatus.textContent = 'Mengupload...';
      kbUploadStatus.className = 'status-message';

      try {
        // Simulasi upload ke knowledge base
        await new Promise(resolve => setTimeout(resolve, 3000));

        kbUploadStatus.textContent = `Dokumen "${documentName}" berhasil diupload ke Knowledge Base`;
        kbUploadStatus.className = 'status-message success';

        // Reset form
        docName.value = '';
        kbFileInput.value = '';
      } catch (error) {
        kbUploadStatus.textContent = `Error: ${error.message}`;
        kbUploadStatus.className = 'status-message error';
      }
    }

    // Initialize
    showSection('chat');
  </script>
</body>
</html>